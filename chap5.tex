\chapter{Extension and Traces}
\label{chap:extAndTrace}

Here, we will study how we can extend functions in $\WW^{k,p}(\Omega)$ to $\WW^{k,p}(\R^n)$.
Moreover, we will see how we can define boundary values on $\partial\Omega$ of functions in $\WW^{k,p}(\Omega)$.

\section{Flattening the Boundary}

We will frequently use that if $\Omega$ is a bounded domain with $\partial\Omega \in \CC^m$, we can transform $\Omega \cap \BB_r(x^0)$ for $x^0 \in \partial\Omega$ to a domain having a flat boundary, where the transformation is a $\CC^m$\hyp{}diffeomorphism.
This will be done in details here.

\begin{ntion}
  \label{ntion:halfspace}
  We define 
  $$
  \R^n_+ \coloneqq \{x \in \R^n \colon x_n > 0 \}, \quad \R^n_-\coloneqq \{x \in \R^n \colon x_n < 0\},
  $$
  and for $U \subset \R^n$
  $$
  U^+ \coloneqq U \cap \R^n_+, \quad U^- \coloneqq U \cap \R^n_-, \quad U^0 \coloneqq \{x \in U \colon x_n = 0\}.
  $$
  Moreover, we write $x = (x', x_n)$ for $x \in \R^n$ with $x = (x_1,\dots,x_n)$ and $x' =(x_1, \dots, x_{n - 1}) \in \R^{n - 1}$.
\end{ntion}

\begin{defn}
  \label{defn:CmDiffeo}
  Let $\Omega$ and $U$ be domains in $\R^n$.
  A map $g \colon \Omega \to U$ is called \emph{$\CC^m$\hyp{}diffeomorphism} if and only if $g$ is bijective, $g \in \CC^m(\overline{\Omega},\R^n)$, $g^{-1} \in \C^m(\overline U, \R^n)$ and $\det(\DD g) \neq 0$ in $\overline \Omega$.
\end{defn}

If $\partial \Omega \in \CC^m$, then we can locally transform $\Omega$ to a domain with flat boundary.

\begin{lem}
  \label{lem:flattening}
  Let $m \in \N$ and $\gamma \in \C^m(\R^{n - 1})$.
  Then $\Phi \colon \R^n \to \R^n$ and $\Psi \colon \R^n \to \R^n$ defined by
  \begin{align*}
    \Phi(x) &= (x_1,\dots,x_{n - 1}, x_n - \gamma(x')),\\
    \Psi(y) &= (y_1,\dots,y_{n - 1}, y_n + \gamma(y')), \quad x,y \in \R^n,
  \end{align*}
  satisfy $\Phi,\Psi \in \CC^m(\R^n,\R^n)$, $\det(\DD\Phi) = \det(\DD \Psi) =1$ on $\R^n$, and $\Phi^{-1} = \Psi$.
  In particular, for any bounded domain $\Omega$, $\Phi|_\Omega \colon \Omega \to \Phi(\Omega)$ is a $\CC^m$\hyp{}diffeomorphism.
  If $\partial \Omega \in \CC^m$ and 
  \begin{align*}
    \Omega \cap \BB_r(x^0) &= \{ x \in \BB_r(x^0) \colon x_n > \gamma'(x')\},\\
    \partial \Omega \cap \BB_r(x^0) &= \{ x \in \BB_r(x^0) \colon x_n = \gamma(x')\}
  \end{align*}
  for some $x^0 \in \partial \Omega$ (see Definition \ref{defn:CmBoundary}), then $\Phi\colon \BB_r(x^0) \to U \coloneqq \Phi(B_r(x^0))$ is a $\CC^m$\hyp{}diffeomorphism with $\Phi(\Omega \cap \BB_r(x^0)) = U^+$ and $\Phi(\partial\Omega \cap \BB_r(x^0)) = U^0$.
\end{lem}

\begin{proof}
  It is straightforward to see that $\Phi$ and $\Psi$ are $\CC^m$-functions with $\Psi = \Phi^{-1}$ and $\det(\DD\Phi) = \det(\DD\Psi) = 1$.
  The further claims are immediate consequences of Definition \ref{defn:CmDiffeo}.
\end{proof}

$\Phi$ now provides a transformation which \emph{flattens} the boundary.
A $\CC^m$\hyp{}diffeomorphism also provides a transformation between the corresponding Sobolev spaces.

\begin{prop}
  \label{prop:sobolevTransform}
  Let $g \colon U \to \Omega$ be a $\CC^m$\hyp{}diffeomorphism with $m \in \N$, $p \in (1,\infty)$, and $\Omega,U \subset \R^n$ bounded domains.
  Then the map $T_g \colon \WW^{m,p}(\Omega) \to \WW^{m,p}(U)$, defined by
  $$
  (T_g(u))(y) \coloneqq u(g(y)), \quad y \in U, u \in \WW^{m,p}(\Omega),
  $$
  is bijective and there exist $C_1, C_2 > 0$ such that
  $$
  \|T_g(u)\|_{\WW^{m,p}(U)} \leq C_1 \|u\|_{\WW^{m,p}(\Omega)}
  \quad\text{and}\quad
  \|(T_g)^{-1}(v)\|_{\WW^{m,p}(\Omega)} \leq C_2 \|v\|_{\WW^{m,p}(U)}
  $$
  for all $u \in \WW^{m,p}(\Omega)$, $v \in \WW^{m,p}(U)$, where $(T_g)^{-1} = T_{g^{-1}}$.
\end{prop}

\begin{proof}
  \begin{enumerate}[i)]
    \item If $T_g$ is well-defined and satisfies the claimed estimate, it is immediate that $(T_g)^{-1} = T_{g^{-1}}$ and hence the estimate for $(T_g)^{-1}$ follows by replacing $g$ by $g^{-1}$.
      Moreover, we only consider the case $m = 1$ as the general case then follows by induction.
    \item Let $m = 1$ and $T \coloneqq T_g$.
      Assume first that $u \in \CC^\infty(\Omega) \cap \WW^{1,p}(\Omega)$.
      Then the chain rule and the transformation rule imply with $M \coloneqq \|\det(\DD g^{-1})\|_{\CC^0(\overline{\Omega})}$
  \begin{equation}
    \label{eq:trafo}
    \int_U |T(u)(y)|^p \d y
     = \int_\Omega |u(x)|^p \, |\det(\DD g^{-1})(x)| \d x
    \leq M \int_\Omega |u(x)|^p \d x,
  \end{equation}
  $$
  \partial_{y_i} (T(u))(y)
  = \sum_{j = 1}^n u_{x_j}(x) \, (g_j)_{y_i}(y)
  = \sum_{j = 1}^n T(u_{x_j})(y) \, (g_j)_{y_i}(y), \quad y \in U,
  $$
  where $x = g(y)$ ($x \in \Omega, y \in U$), and
  \begin{align*}
    \left( \int_U |(\partial_{y_i}(T(u))(y)|^p \d y\right)^{\frac{1}{p}}
    & \leq \|g\|_{\CC^1(\overline U)} \sum_{j = 1}^n \left( \int_U |T(u_{x_j})(y)|^p \d y \right)^{\frac{1}{p}} \\
    & \overset{\eqref{eq:trafo}}{\leq} \|g\|_{\CC^1(\overline U)} \, M^{\frac{1}{p}} \, \sum_{j = 1}^n \|u_{x_j} \|_{\Ell^p(\Omega)}.
  \end{align*}
  Hence, $\|T(u)\|_{\WW^{1,p}(U)} \leq M^{\frac{1}{p}} (1 + n\|g\|_{\CC^1(\overline U)}) \, \|u\|_{\WW^{1,p}}$ by combining the previous estimate with \eqref{eq:trafo} and Minkowski's inequality.
\item By ii) we have
  $$
  \|T(u)\|_{\WW^{1,p}(U)} \leq C_1 \|u\|_{\WW^{1,p}(\Omega)} \quad \text{for all } u \in \CC^\infty(\Omega) \cap \WW^{1,p}(\Omega).
  $$
  For $u \in \WW^{1,p}(\Omega)$ there exists $(u_k)_{k \in \N} \subset \CC^\infty(\Omega) \cap \WW^{1,p}(\Omega)$ such that $u_k \to u$ in $\WW^{1,p}(\Omega)$ and a.e. in $\Omega$.
  As $T$ is linear, we have
  $$
  \| T(u_k) - T(u_j)\|_{\WW^{1,p}(U)} \leq C_1 \|u_k - u_j\|_{\WW^{1,p}(\Omega)}, \quad\text{for all } k,j \in \N.
  $$
  Hence, $(T(u_k))_{k \in \N}$ is a Cauchy sequence in $\WW^{1,p}(U)$ and $T(u_k) \to \WW^{1,p}(U)$ in $\WW^{1,p}(U)$.
  As obviously $T(u_k) \to T(u)$ in $\Ell^p(U)$ by \eqref{eq:trafo} and the dominated convergence theorem, we have $v = T(u) \in \WW^{1,p}(U)$ and 
  $$
  \| T(u) \|_{\WW^{1,p}(U)} 
  = \lim_{k \to \infty} \|T(u_k)\|_{\WW^{1,p}(U)}
      \overset{\text{ii)}}\leq C_1 \lim_{k \to \infty} \|u_k\|_{\WW^{1,p}(\Omega)}
  = C_1 \|u\|_{\WW^{1,p}(\Omega)},
  $$
  where $C_1$ can be chosen independent of $p$ as $M^{\frac{1}{p}} \leq 1 + M$. \qedhere
  \end{enumerate}
\end{proof}

\section{Extension Theorem}

We next extend functions $u \in \WW^{k,p}(\Omega)$ to become a function in $\WW^{k,p}(\Omega)$.
This cannot be done in general by extending $u$ by $0$ to $\R^n \setminus \Omega$ as this may create bad discontinuities in some $\DD^\alpha u$ on $\partial\Omega$.
We need now again boundary regularity of $\partial\Omega$.

\begin{thm}  
  \label{thm:extension}
  Let $m \in \N$, $p \in [1,\infty)$, $\Omega \subset \R^n$ be a bounded domain with $\partial \Omega \in \C^m$, and $V \subset \R^n$ be a domain with $\Omega \Subset V$.
  Then for any $k \in \{1,\dots,m\}$ there exists a linear Operator
  $$
  E \colon \WW^{k,p}(\Omega) \to \WW^{k,p}(\R^n)
  $$
  such that
  \begin{enumerate}[a)]
    \item $E(u) = u$ a.e. in $\Omega$,
    \item $\supp(E(u)) \Subset V$, i.e. $E(u) \in \WW_0^{k,p}(V)$,
    \item $\|E(u)\|_{\WW^{k,p}(\R^n)} \leq C\| u\|_{\WW^{k,p}(\Omega)}$ for all $u \in \WW^{k,p}(\Omega)$,
  \end{enumerate}
  where $C > 0$ depends on $m$, $p$, $V$, and $\Omega$ but not on $K$ and $u$.
  Moreover, $E$ does not depend on $k \in\{1,\dots,m\}$ and on $p \in [1,\dots,\infty)$ in the sense that if $u \in \WW^{k,p}(\Omega)$ for several $p,k$ then $E(u)$ is uniquely determined in all these spaces.
\end{thm}

\begin{proof}
  We will use the notation from \ref{ntion:halfspace}, Lemma \ref{lem:flattening}, and Definition \ref{defn:CmBoundary}.
  \begin{enumerate}[i)]
    \item We first assume that for some $x^0 \in \partial \Omega$, $\BB \coloneqq \BB_r(x^0)$ satisfies $\Omega \cap \BB = \BB^+$ and $\partial\Omega \cap \BB = \BB^0$.
      We further assume that $u \in \CC^m(\BB^+ \cup \BB^0)$ with $\supp(u) \subset \widetilde \BB^+ \coloneqq \overline{(\BB_s(x^0))^+}$ for some $s \in (0,r)$.
      As hence $u = 0$ in a neighborhood of $\partial\BB \cap \overline{\R^n_+}$, we can extend $u$ by $0$ in $\overline{\R^n_+} \setminus \BB^+$ and have $u \in \CC^m(\overline{\R^n_+})$ with $\supp(u) \subset \widetilde \BB^+$.
      Then we extend $u$ from $\overline{\R^n_+}$ to $\R^n$ by a \emph{higher-order reflection}.
      The $(m + 1)\times(m+1)$ system of linear equations
      \begin{equation}
        \label{eq:sle}
        \sum_{j = 1}^{m + 1} (-j)^i \lambda_j = 1, \quad i = 0,\dots,m,
      \end{equation}
      has a unique solution $(\lambda_1,\dots,\lambda_{m + 1})$ since the corresponding matrix is of Vandermonde type.
      We define the extension
      $$
      \tilde E(u) (x) \coloneqq 
      \begin{cases}
        u(x) &\quad\text{if } x = (x',x_n) \text{ with } x_n \geq 0,\\
        \sum_{j = 1}^{m + 1} \lambda_j u(x',-jx_n) &\quad\text{if } x = (x', x_n) \text{ with } x_n < 0,
      \end{cases}
      $$
      and for any $\alpha \in \N_0^n$ with $1 \leq |\alpha| \leq m$
      $$
      \tilde E_\alpha (u) (x) \coloneqq
      \begin{cases}
        u(x) \quad\text{if } x_n \geq 0,\\
        \sum_{j = 1}^{m + 1} (-j)^{\alpha_n}\lambda_j u(x',-jx_n) &\quad\text{if } x_n < 0.
      \end{cases}
      $$
      Then for all $|\alpha| \leq m$ we have $\DD^\alpha(\tilde E(u)) = \tilde E_\alpha(\DD^\alpha u)$ and hence $\tilde E (u) \in \CC^n(\R^n)$:
      This is immediate in $\R^n_+$ and $\R^n_-$, while for $x \in \partial \R^n_+$, namely $x_n = 0$, we have
      \begin{align*}
        \lim_{t \uparrow 0 } \DD^\alpha(\tilde E(u))(x',t)
        &= \lim_{t \uparrow 0} \tilde E_\alpha(\DD^\alpha u)(x', t)
        = \lim_{t \uparrow 0} \sum_{j = 1}^{m + 1} (-j)^{\alpha_n} \lambda_j \DD^\alpha u(x', -jt) \\
        &= \Big(\sum_{j = 1}^{m + 1} (-j)^{\alpha_n} \lambda_j \Big) \DD^\alpha(x',0)
        \overset{\eqref{eq:sle}}{=} \DD^\alpha u(x', 0) \\
        &= \lim_{t \downarrow 0} \DD^\alpha(x', t) 
        = \lim_{t \downarrow 0} \DD^\alpha(\tilde E(u))(x', t)
      \end{align*}
      since $u \in \CC^m(\overline{\R^n_+})$ by assumption.
      Moreover,
      \begin{align*}
        \|\DD^\alpha(\tilde E(u)) \|_{\Ell^p(\R^n)}
       &\leq \Big( 1 + \sum_{j = 1}^{m + 1} j^{\alpha_n} |\lambda_j|\, j^{\frac{1}{p}} \Big) \|\DD^\alpha u\|_{\Ell^p(\R^n_+)}  \\
       &\overset{p \geq 1}{\leq} \Big( 1 + \sum_{j = 1}^{m + 1} j^{\alpha_n + 1} |\lambda_j| \Big) \|\DD^\alpha u\|_{\Ell^p(\R^n_+)},
      \end{align*}
      where we have used the transformation rule with $z = (x', -jx_n)$ and $\supp(u) \subset \widetilde \BB_+ \subset \overline{\BB^+}$.
      Hence, $\tilde E(u) \in\CC^m(\R^n)$ with
      \begin{equation}
        \label{eq:contExt}
        \|\tilde E (u)\|_{\WW^{k,p}(\R^n)} \leq C_1 \|u\|_{\WW^{k,p}(\BB^+)}
      \end{equation}
      with $C_1$ depending on $m$ and $n$.

    \item As $\partial \Omega \in \CC^m$ and $\partial \Omega$ is compact, there exists $x^i \in \partial\Omega$ and balls $U_i \coloneqq \BB_r(x^i), i = 1,\dots,N$, such that after relabelling and renumbering the coordinate axes (described by a $\CC^\infty$\hyp{}diffeomorphism $\Tau_i \colon \R^n \to \R^n$), we have
      \begin{align*}
        \Omega \cap U_i &= \{ x \in U_i \colon x_n > \gamma_i(x') \} \\
        \partial\Omega \cap U_i &= \{x \in U_i \colon x_n = \gamma_i(x')\}
      \end{align*}
      with $\gamma_i \in \CC^m(\R^{n - 1})$.
      Choose $U_0 \Subset \Omega$ such that $\overline\Omega \subset \bigcup_{i = 0}^N U_i$.
      By Lemma \ref{lem:partitionOfUnity} there exists a partition of unity $\varphi_i \in \CC_0^\infty(\Tau_i^{-1}(U_i))$ with $0 \leq \varphi_i \leq 1$ and $\sum_{i = 1}^N \varphi_i(x) = 1$ for all $x \in \overline\Omega$.
      Define further $\Phi_i,\Psi_i$ by Lemma \ref{lem:flattening} according to $\gamma = \gamma_i, i = 1,\dots,N,$ and set $W_i \coloneqq \Phi_i(U_i)$.

      We fix $i \in \{1,\dots,N\}$ and $u \in \CC^m(\overline\Omega)$.
      Then $\varphi_i u$ and hence also $T_{\Tau_i^{-1}}(\varphi_i u)$ belong to $\CC^m(\overline U_i \cap \overline\Omega)$ with compact support $K_i \Subset U_i, K_i \subset \Tau_i(\overline\Omega)$.
      Then
      $$
      v_i \coloneqq T_{\vphantom{\Tau_i^{-1}}{\Psi_i^{\vphantom{-1}}}}(T_{\Tau_i^{-1}}(\varphi u)) \in \CC^m(\overline{W_i^+})
      $$
      with support in $\Phi(K_i) \Subset W_i$ and $\Phi_i(K_i) \subset W_i^+ \cup W_i^0$.
      Hence, we may apply $\tilde E$ to $v_i$ (by choosing $\widetilde \BB^+$ and $\BB$ appropriately such that $\Phi_i(K_i) \subset \widetilde \BB^+ \Subset W_i \Subset B)$ and obtain
      $$
      \tilde E(v_i)  \in \CC^m(\R^n) \cap \WW^{k,p}(\R^n).
      $$
      Transforming back, we finally obtain
      $$
      u_i \coloneqq T_{\Tau_i} ( T_{\Phi_i}( \tilde E(v_i))) \in \WW^{k,p}(\R^n).
      $$
      As $\tilde E(v_i)$ has compact support in some ball $\BB_i \subset \R^n$, we may apply Proposition \ref{prop:sobolevTransform} with 
      $$
      \Phi_i \coloneqq \Phi_i^{-1}(\BB_i) \to \BB_i \quad\text{and}\quad
      \Tau_i \colon \Tau_i^{-1}(\Phi_i^{-1}(\BB_i)) \to \Phi_i^{-1}(B_i)
      $$
      and obtain $u_i = \varphi_i u$ in $\Omega$ and 
      \begin{align*}
        \|u_i\|_{\WW^{k,p}(\R^n)}
        &\leq C_2 \| \tilde E(v_i) \|_{\WW^{k,p}(\BB_i)}
        \overset{\mathrm i)}{\leq} C_3 \| v_i \|_{\WW^{k,p}(W_i^+)} \\
        &\overset{\text{Prop. \ref{prop:sobolevTransform}}}{\leq} C_4 \|\varphi_i u\|_{\WW^{k,p}(\Omega \cap U_i)}  
        \overset{\substack{\text{Prop. \ref{prop:sobolevProperties}} \\ \text{Lem. \ref{lem:cutoff}}}}{\leq} C_5 \|u\|_{\WW^{k,p}(\Omega \cap U_i)}.
      \end{align*}
      Defining further $u_0 \coloneqq \varphi_0 u \in \CC^m(U_0)$ with compact support in $U_0$, we have 
      $$
        \sum_{i = 0}^n u_i \in \WW^{k,p}(\R^n) \quad\text{with}\quad \| \sum_{i = 0}^N u_i \|_{\WW^{k,p}(\R^n)} \leq C_6 \|u\|_{\WW^{k,p}(\Omega)} 
        $$
        and
        $$
        \sum_{i = 0}^N u_i = \sum_{i = 0}^N \varphi_i u = u \quad\text{in }\Omega.
        $$
        Finally, let $\tau \in \CC_0^\infty(V)$ be the cutoff-function w.r.t $\overline \Omega$ and $V$. Then
        $$
        E(u) \coloneqq \tau \cdot \sum_{i = 0}^N u_i \in \WW^{k,p}(\R^n) \quad\text{with } \supp (E(u)) \Subset V
        $$
        and
        \begin{equation}
          \label{eq:continuousExtension}
          \|E(u)\|_{\WW^{k,p}(\R^n)} \leq C_7 \|u \|_{\WW^{k,p}(\Omega} \quad\text{for all } u \in \C^m(\overline\Omega),
        \end{equation}
        where $C_7 > 0$ does not depend on $k$ or $u$ but on $m,p,\Omega$ and $V$.
        Moreover, $E(u) = u$ in $\Omega$.

      \item As $\tilde E$ is linear in $u$ and $T_g$ is linear in $u$ (see Proposition \ref{prop:sobolevTransform}), the map
        $$
        E \colon \CC^m(\overline\Omega) \to \WW^{k,p}(\R^n), \quad u \mapsto E(u)
        $$
        is linear.
        Let $u \in \WW^{k,p}(\Omega)$.
        Then by Theorem \ref{thm:CinftyUpToBoundary} there exists $(u_j)_{j\in \N} \subset \CC^m(\overline\Omega)$ such that $u_j \to u$ in $\WW^{k,p}(\Omega)$.
        Then by \eqref{eq:continuousExtension}
        $$
        \|E(u_j) - E(u_i) \|_{\WW^{k,p}(\R^n)} \leq C_7 \|u_j - u_i \|_{\WW^{k,p}(\Omega)} \quad\text{for all } i,j \in \N
        $$
        so that $(E(u_j))_{j \in \N}$ is a Cauchy sequence in $\WW^{k,p}(\R^n)$ and has a limit $v \in \WW^{k,p}(\R^n)$.
        As $E(u_j) \to v$ a.e. in $\R^n$ for a subsequence, we still have $\supp(v) \Subset V$ and $u = v$ a.e. in $\Omega$.
        Defining $E(u) \coloneqq v$, we have
        $$
        \|E(u)\|_{\WW^{k,p}(\R^n)} \leq C_7 \|u\|_{\WW^{k,p}(\Omega)}
        $$
        by \eqref{eq:continuousExtension} like in the end of the proof of Proposition \ref{prop:sobolevTransform}. 
        Since \eqref{eq:continuousExtension} implies that $E(u) = v$ does not depend on the choice of the approximating sequence $(u_j)_{j \in \N}$ (as $E$ is linear), we thereby have defined $E \colon \WW^{k,p}(\Omega) \to \WW^{k,p}(\R^n)$ having all claimed properties. \qedhere
  \end{enumerate}
\end{proof}

\section{Trace Operator}

A function $u \in \WW^{1,p}(\Omega) \cap \CC^0(\overline\Omega)$ clearly has boundary values on $\partial\Omega$ in the usual sense.
But a general function $u \in \WW^{1,p}(\Omega)$ is not continuous and only defined a.e. in $\Omega$. 
Since $\partial\Omega$ has $n$-dimensional Lebesgue measure $0$, we need a trace operator involving the space $\Ell^p(\partial\Omega)$ for assigning boundary values to $u$.

\begin{defn}
  \label{defn:boundarySpace}
  Let $\Omega$ be a bounded domain with $\partial\Omega \in \CC^1$ and 
  $U_i \coloneqq \BB_{r_i}(x^i), i = 1,\dots,N$, such that 
  $\Omega \cap U_i = \{x \in U_i \colon x_n > \gamma_i(x') \}$, 
  $\partial \Omega \cap U_i = \{x \in U_i \colon x_n = \gamma_i(x') \}$ 
  with $\gamma_i \in \CC^1(\R^{n - 1})$ and $x^i \in \partial\Omega$ (where we assume that the coordinate axes are relabeled and reoriented appropriately).
  Defining
  $$
  U_i' \coloneqq \{ x' \colon x \in \partial\Omega \cap U_i \} \subset \R^{n - 1},
  $$
  we have 
  $$
  \partial\Omega \cap U_i = \{ (x', \gamma_i(x')) \colon x' \in U_i' \}.
  $$
  Let $U$ be a neighborhood of $\partial\Omega$ (in $\R^n$) such that $U \Subset \bigcup_{i = 1}^N U_i$ and $\varphi_i, i = 1,\dots,N,$ a corresponding partition of unity such that $\varphi_i \in \CC_0^\infty(U_i)$, $\sum_{i = 1}^N \varphi_i(x) = 1$ for all $x \in U$, $0 \leq \varphi_i \leq 1$.
  Then $v \colon \partial\Omega \to \R$ is called \emph{measurable} on $\partial\Omega$ if 
  $$
  v_i \colon U_i' \to \R, \quad v_i(x') \coloneqq (\varphi_i v)(x', \gamma_i(x'))
  $$
  is measurable in $U_i' \subset \R^{n - 1}$.

  Defining
  $$
  \int_{\partial\Omega} v_i \d \sigma
  \coloneqq \int_{\partial\Omega \cap U_i} v_i \d \sigma
  \coloneqq \int_{U_i'} v_i \sqrt{1 + |\nabla\gamma_i|^2} \d x'
  $$
  and
  $$
  \int_{\partial \Omega} v \d \sigma \coloneqq \sum_{i = 1}^N \int_{\partial \Omega} v_i \d \sigma,
  $$
  then $\Ell^p(\partial\Omega)$ is the space of functions $v \colon \partial\Omega \to \R$ being measurable on $\partial\Omega$ such that the norm
  $$
  \| v\|_{\Ell^p(\partial \Omega)} \coloneqq \left( \int_{\partial\Omega} |v|^p \d \sigma \right)^{\frac{1}{p}}
  $$
  is finite where $p \in [1,\infty)$.
\end{defn}

Then we have the following theorem:

\begin{thm}[Trace theorem]
  \label{thm:trace}
  Let $\Omega$ be a bounded domain with $\partial\Omega \in \CC^1$ and $p \in [1,\infty)$.
    Then there exists a bounded linear operator $\Tr \colon \WW^{1,p}(\Omega) \to \Ell^p(\partial\Omega)$ such that
    \begin{enumerate}[a)]
      \item $\Tr(u) = u|_{\partial\Omega}$ if $u \in \WW^{1,p}(\Omega) \cap \CC^0(\overline\Omega)$,
      \item $\|\Tr(u)\|_{\Ell^p(\partial\Omega)} \leq C \, \|u\|_{\WW^{1,p}(\Omega)}$ for any $u \in \WW^{1,p}(\Omega)$, where $C > 0$ only depends on $p$ and $\Omega$.
    \end{enumerate}
    $\Tr(u)$ is called the \emph{trace of $u$ on $\partial\Omega$}.
\end{thm}

\begin{proof}
  \begin{enumerate}[i)]
    \item Assume like in the proof of Theorem \ref{thm:extension} that there is $x^0 \in \partial \Omega$ and $\BB \coloneqq \BB_r(x^0) \subset \R^n$ such that $\Omega \cap \BB = \BB^+$ and $\partial\Omega \cap \BB = \BB^0$.
  Let $\hat \BB \Subset \BB$ and $\xi \in \CC_0^\infty(\BB)$ such that $\xi > 0$ in $\hat\BB$ and $0 \leq \xi \leq 1$ (see Lemma \ref{lem:cutoff}).
  Furthermore, assume $p \in (1,\infty)$.
  Then setting
  $$
  \BB' \coloneqq \{ x' \colon (x', x_n) \in \BB \} \subset \R^{n - 1},
  $$
  we have for $u \in \CC^1(\overline\Omega)$
  \begin{align*}
    \int_{\partial\Omega \cap \BB} |\xi u|^p \d \sigma 
    &= \int_{\BB'} |\xi u|^p(x', 0) \d x' \nonumber\\
    &= \int_{\BB'} \Bigg( \Big[ - \int_0^{\tilde x} \partial_{x_n} (|\xi u|^p)(x',s) \d s \Big] + \underbrace{|\xi u|^p (x', \tilde x)}_{= 0} \d x' \Bigg),\nonumber\\
    \intertext{where $(x',\tilde x) \in \partial \BB \cap (\overline{\BB^+} \setminus \BB^0)$,}
    &= -\int_{\BB^+} \Big( |u|^p \, p \, \xi^{p - 1} \, \xi_{x_n} + \xi^p \, p \, |u|^{p - 1} \, u_{x_n} \Big)(x) \d x \nonumber\\ 
    &\leq C_1 \int_{\BB^+} (|u|^p + |u|^{p-1} \, |u_{x_n}| ) \d x \\
    &\leq C_2 \int_{\BB^+} (|u|^p + |u_{x_n}|^p ) \d x \\
    &\leq C_2 \, \| u\|_{\WW^{1,p}(\BB^+)}^p,
  \end{align*}
      where $C_2 > 0 $ depends on $p$ and $\xi$ and we used \emph{Young's inequality}
    $$
    |a b | \leq \frac{1}{p} |a|^p + \frac{1}{q} |b|^q \quad\text{for } a,b \in \R, p,q \in [1,\infty], \frac{1}{p} + \frac{1}{q} = 1,
    $$
    with $a = u_{x_n}(x)$, $b = |u|^{p - 1}(x)$, $q = \frac{p}{p - 1}$.
    Summing up the previous calculation, we have shown
    \begin{equation}
      \label{eq:C1Bounded}
      \int_{\partial\Omega \cap \BB} |\xi u|^p \d \sigma 
      \leq C_2 \| u\|_{\WW^{1,p}(\BB^+)}^p \quad\text{for all } u \in \CC^1(\overline\Omega), p \in (1,\infty).
    \end{equation}
    A similar calculation shows that \eqref{eq:C1Bounded} also holds for $p = 1$.

  \item In the general case of Definition \ref{defn:boundarySpace}, let $B^i = B_{s_i}(x^i)$ such that $\Phi_i(U_i) \subset \BB^i$ (with $\Phi_i, \Psi_i$ from Lemma \ref{lem:flattening} with $\gamma = \gamma_i$ to flatten the boundary).
    Then applying \eqref{eq:C1Bounded} with $\BB = \BB^i$, $\xi = T_\Psi(\varphi_i)$, we obtain with $u_i = \varphi_i u$ for $u \in \CC^1(\overline\Omega)$
    \begin{align*}
      \int_{\partial\Omega} | u_i |^p \d \sigma
      &= \int_{U_i'} |\varphi_i u|^p (x', \gamma_i(x')) \sqrt{1 + |\nabla\gamma_i(x')|^2} \d x' 
      \leq C_3 \int_{(B^i)'} | T_{\Psi_i}(\varphi_i u) |^p (x', 0) \d x' \\
      &\overset{\eqref{eq:C1Bounded}}{\leq} C_4 \, \|T_{\Psi_i} u\|^p_{\WW^{1,p}((\BB^i)^+)} 
      \overset{\text{Prop. \ref{prop:sobolevTransform}}}{\leq} C_5 \, \|u\|^p_{\WW^{1,p}(\Omega)}.
    \end{align*}
    Hence,
    $$
      \|u\|_{\Ell^p(\partial\Omega)} \leq \sum_{i = 1}^N \|u_i\|_{\Ell^p(\partial\Omega)} \leq N \cdot C_5^{\frac{1}{p}} \, \|u\|_{\WW^{1,p}(\Omega)} \quad\text{for all } u \in \CC^1(\overline\Omega),
    $$
    with $C_5$ depending on $p$ and $\Omega$.

  \item By defining $\Tr(u) \coloneqq u|_{\partial\Omega}$ for $u \in \CC^1(\overline\Omega)$, we have
    $$
    \| \Tr(u)\|_{\Ell^p(\partial\Omega)} \leq C_6 \, \|u\|_{\WW^{1,p}(\Omega)} \quad\text{for all } u \in \CC^1(\overline\Omega)
    $$
    by ii).
    If $u \in \WW^{1,p}(\Omega)$ is arbitrary, as $\Tr$ is linear in $u$, we can show like in part iii) of the proof of Theorem \ref{thm:extension} that there exist $(u_l)_{l \in \N} \subset \CC^{1}(\overline\Omega)$ such that $u_l \to u$ in $\WW^{1,p}(\Omega)$ and $\Tr(u_l) \to v$ in $\Ell^p(\partial\Omega)$ for some $v \in \Ell^p(\partial\Omega)$.
    Hence, defining $\Tr(u) \coloneqq v$ the operator $\Tr \colon \WW^{1,p}(\Omega) \to \Ell^p(\partial\Omega)$ is well defined and satisfies b) with $C = C_6$.

  \item If $u \in \WW^{1,p}(\Omega) \cap \CC^0(\overline\Omega)$ and $(\tilde u_l)_{l \in \N}$ in $\CC^1(\overline\Omega)$ such that $\tilde u_l \to u$ in $\WW^{1,p}(\Omega)$, we remark that we can choose $(\tilde u_l)_{l \in \N}$ in the proof of Theorem \ref{thm:CinftyUpToBoundary} such that $\tilde u_l$ converges to $u$ in $\CC^0(\overline\Omega)$.
    ($u_i$ is uniformly continuous (compact support), $w_t \to u_i$ in $\CC^0(\overline\Omega)$ as $t \downarrow 0$ since $w_t$ is a translation and $\varphi_i = \eta_\varepsilon \ast w_t \to w_t$ in $\CC^0(\overline\Omega)$ as $\varepsilon \downarrow 0$  by Theorem \ref{thm:mollifier} (as $\overline\Omega \Subset \R^n \setminus \Gamma_t$)).
    Hence, $\Tr (u) = \lim_{l \to \infty} \Tr (\tilde u_l) = \lim_{l \to \infty} \tilde u_l|_{\partial\Omega} = u|_{\partial \Omega}$. \qedhere
\end{enumerate}
\end{proof}

Next, we characterize $\WW_0^{k,p}(\Omega)$ functions in terms of trace zero functions.

\begin{thm}
  Let $\Omega \subset \R^n$ be a bounded domain with $\partial\Omega \in \CC^k$ and assume that $k \in \N$, $p \in [ 1, \infty)$, and $u \in \WW^{k,p}(\Omega)$.
    Then
    $
    u \in \WW_0^{k,p}(\Omega)$ if and only if $\Tr(\DD^\alpha u) = 0$ for all  $\alpha \in \N_0^n$ with $|\alpha| \leq k - 1$.
    In particular, $\WW_0^{1,p}(\Omega) = \{ u \in \WW^{1,p}(\Omega) \colon \Tr(u) = 0 \}$.
\end{thm}

\begin{proof}
  \begin{enumerate}[i)]
    \item ``$\Rightarrow$'' for $k = 1$:
      Let $u \in \WW_0^{1,p}(\Omega)$.
      Then there are $(u_m)_{m \in \N} \in \CC_0^\infty(\Omega)$ with $u_m \to u$ in $\WW^{1,p}(\Omega)$.
      As $\Tr(u_m) = u_m|_{\partial\Omega} = 0$ and Theorem \ref{thm:trace} shows
      \begin{align*}
        \| \Tr(u) \|_{\Ell^p(\partial\Omega)}
        &= \|\Tr(u) - \Tr(u_m)\|_{\Ell^p(\partial\Omega)}
        = \| \Tr(u - u_m) \|_{\Ell^p(\partial\Omega)} \\
        &\leq C \|u - u_m\|_{\WW^{1,p}(\Omega)} \to 0 \quad \text{as } m \to \infty,
      \end{align*}
      we have $\Tr(u) = 0$ in $\Ell^p(\Omega)$.

    \item ``$\Leftarrow$'' for $k = 1$:
    Assume that $u \in \WW^{1,p}(\Omega)$ with $\Tr(u) = 0$.
    Then by Theorems \ref{thm:CinftyUpToBoundary} and \ref{thm:trace} there exists $(u_m)_{m \in \N} \subset \CC^1(\overline\Omega)$ such that $u_m \to u$ in $\WW^{1,p}(\Omega)$ and $\Tr(u_m) \to \Tr(u) = 0$ in $\Ell^p(\partial\Omega)$.
    By Definition \ref{defn:boundarySpace} this means $\Tr(\varphi_i u_m) \to \Tr(\varphi_i u) = 0$ in $\Ell^p(\partial\Omega \cap U_i)$ for $i = 1,\dots,N$.
    Hence, fixing $i \in \{1, \dots, N\}$ and $\Phi_i, \Psi_i$ from Lemma \ref{lem:flattening} (with $\gamma = \gamma_i$) we have $v_m \coloneqq T_{\Psi_i}(\varphi_i u_m) \in \CC^1(\BB^+ \cup \BB^0)$ and $v \coloneqq T_{\Psi_i}(\varphi_i u) \in \WW^{1,p}(\BB^+)$ with $\Tr(v_m) \to \Tr(v) = 0$ in $\Ell^p(\BB^0)$ for some ball $\BB = \BB_s(x^i) \subset \R^n$ (see part ii) of the proof of Theorem \ref{thm:trace}), where $v_m$, $v$ have compact supports $K_m$, $K$ in $\BB \cap \overline{\BB^+}$.

    If we find $w_m \in \CC_0^\infty(\BB^+)$ with $w_m \to v$ in $\WW^{1,p}(\BB^+)$, by proposition \ref{prop:sobolevTransform} there is $f_i \coloneqq T_{\Phi_i}(w_m) \in \CC^1(\Omega)$ with $\supp(f_i) \subset \Omega \cap U_i$ such that 
    $\|f_i - \varphi_i u\|_{\WW^{1,p}(\Omega)} \leq \frac{\delta}{2(N + 1)}.$
    Then $\tilde u \coloneqq u - \sum_{i = 1}^N \varphi_i u$ has compact support in $\Omega$ so that by Theorems \ref{thm:interiorApproximation} and \ref{thm:mollifier} there is $f_0 \in \CC_0^\infty(\Omega)$ such that 
    $\| \tilde u - f_0 \|_{\WW^{1,p}(\Omega)} \leq \frac{\delta}{2(N + 1)}.$

    Then $\| u - \sum_{i = 0}^N f_i \|_{\WW^{1,p}(\Omega)} \leq \frac{\delta}{2}$ and $f \coloneqq \sum_{i = 0}^N f_i \in \CC^1(\Omega)$ with compact support in $\Omega$.
    Hence, by Theorems \ref{thm:interiorApproximation} and \ref{thm:mollifier} there is $g \in \CC_0^\infty(\Omega)$ such that $\|g - f\|_{\WW^{1,p}(\Omega)} \leq \frac{\delta}{2}$ and $\|u - g\|_{\WW^{1,p}(\Omega)} \leq \delta$.
    Hence, $u \in \WW_0^{1,p}(\Omega)$ as $\delta > 0$ is abritrary.

  \item It remains to find $w_m \in \CC_0^\infty(\BB^+)$ with $w_m \to v$ in $\WW^{1,p}(\BB^+)$.
    We have
    \begin{equation}
      \label{eq:traceAndSobolevConv}
      \Tr(v_m) \to \Tr(v) = 0 \text{ in } \Ell^p(\BB^0) 
      \quad\text{and}\quad
      v_m \to v \text{ in } \WW^{1,p}(\BB^+)
    \end{equation}
    by ii) and Proposition \ref{prop:sobolevTransform} and \ref{prop:sobolevProperties}.
    As $v_m \in \CC^1(\BB^+ \cup \BB^0)$ we have for $x \in \BB^+ \cup \BB^0$ with $\BB' = \{x' \colon (x', x_n) \in \BB\}$ and $\frac{1}{q} + \frac{1}{p} = 1$.
    $$
    |v_m(x', x_n)|
    \leq |v_m(x',0)| + \int_0^{x_n} |(v_m)_{x_n} (x', t)| \d t
    $$
    and
    \begin{align*}
      &\int_{\BB'} |v_m(x', x_n)|^p \d x' \\
      &\quad\overset{\text{Hölder}}{\leq} 2^p \left( \int_{\BB'} |v_m(x',0)|^p \d x' + \int_{\BB'} \left[ \Big(\int_0^{x_n} 1^q \d t\Big)^{\frac{1}{q}} \Big( \int_0^{x_n} |\nabla v_m(x',t)|^p \d t \Big)^{\frac{1}{p}} \right]^p \d x' \right) \\
      &\quad\overset{\text{Fubini}}{\leq} 2^p \Big( \|v_m\|_{\Ell^p(\BB^0)}^p + x_n^{p - 1} \int_0^{x_n} \int_{\BB'} | \nabla v_m(x',t)|^p \d x' \d t \Big)
    \end{align*}
    since $\frac{p}{q} = p - 1$ and $(a + b)^p \leq 2^{p - 1}(a^p + b^p)$ for $a,b \geq 0$.

    Hence, by \eqref{eq:traceAndSobolevConv} and the dominated convergence theorem, we obtain as $m \to \infty$ (for a subsequence)
    \begin{equation}
      \label{eq:vEstimateByGradient}
      \int_{\BB'} |v(x',x_n)|^p \d x'
      \leq 2^p x_n^{p - 1} \int_0^{x_n} \int_{\BB'} |\nabla v(x',t)|^p \d x' \d t \quad\text{for all } x_n > 0
    \end{equation}
    since we may extend $v, v_m$ by $0$ to $\overline{\R^n_+}$ without loosing regularity.

    Let $\xi \in \C^\infty([0,\infty))$ such that $\xi \equiv 1$ on $[0,1]$ and $\xi \equiv 0$ on $[2,\infty)$ and define 
      $$\xi_m (x) \coloneqq \xi(mx_n), \quad x \in \overline{\BB^+}, m \in \N,$$ and 
      $$\tilde w_m(x) \coloneqq v(x)(1 - \xi_m(x)).$$
      As $(\tilde w_m)_{x_n} = v_{x_n}(1 - \xi_m) - m\, v\, \xi'(m x_n)$ and $(\tilde w_m)_{x_i} = v_{x_i}(1 - \xi_m)$ for $i = 1,\dots,n-1$, we have as $\xi_m =0$ for $x_n \geq \frac{2}{m}$
      \begin{align*}
      \int_{\BB^+} |\nabla \tilde w_m - \nabla v|^p \d x
      &\leq C_p \int_{\BB^+} (\xi_m)^p |\nabla v|^p \d x + C_p m^p\, \|\xi'\|_{\Ell^\infty([0,\infty))}^p \int_0^{\frac{2}{m}} \int_{\BB'} |v|^p \d x \d t \\
        &\eqqcolon A_m + B_m.
      \end{align*}
      As $\xi_m \neq 0$ only for $0 \leq x_n < \frac{2}{m}$, the dominated convergence theorem shows $A_m \to 0$ as $m \to \infty$.
      Using \eqref{eq:vEstimateByGradient}, we obtain
      \begin{align*}
      B_m 
      &\leq C \cdot m^p  \int_0^{\frac{2}{m}}\Big[ t^{p - 1} \int_0^{t} \int_{\BB'} |\nabla v|^p(x',s) \d x' \d s \Big] \d t \\
      &\leq C \cdot m^p \Big( \int_0^{\frac{2}{m}} t^{p - 1} \d t \Big) \Big( \int_0^{\frac{2}{m}} \int_{\BB'} |\nabla v|^p(x',s) \d x' \d s \Big) \\
      &\leq \tilde C \int_0^{\frac{2}{m}} \int_{\BB'} |\nabla v|^p \d x' \d s \to 0 \quad\text{as } m \to \infty 
      \end{align*}
      by the dominated convergence theorem.
      Hence, $\nabla \tilde w_m \to \nabla v$ in $\Ell^p(\BB^+)$ and, as obviously $\tilde w_m \to v$ in $\Ell^p(\BB^+)$, we have $\tilde w_m \to v$ in $\WW^{1,p}(\BB^+)$.
      As $\tilde w_m = 0$ for $x_m \in [0,\frac{1}{m})$ and $\supp \tilde w_m \subset \supp v$, we have $\supp \tilde w_m \Subset \BB^+$.
        Hence, $w_m \coloneqq \eta_{\varepsilon_m} \ast \tilde w_m \in \CC_0^\infty(\BB^+)$ satisfies $W_m \to v$ in $\WW^{1,p}(\BB^+)$ for $\varepsilon_m \downarrow 0$ chosen appropriately (by Theorems \ref{thm:interiorApproximation} and \ref{thm:mollifier}).
        Hence, ii) shows $u \in \WW_0^{1,p}(\Omega)$.
  \end{enumerate}
\end{proof}
