\chapter{Applications to PDEs}
\label{chap:appsToPDEs}

As a prototype of so called \emph{elliptic PDEs}, we will study the \emph{Poisson equation with Dirichlet boundary conditions}, i.e.
\begin{equation}
  \label{eq:poissonDirichlet}
  \left\{
    \begin{alignedat}{2}
    -\Delta u(x) &= f(x), &&\quad x \in \Omega \\
    u(x) &= 0, &&\quad x \in \partial\Omega,
    \end{alignedat}
    \right.
\end{equation}
where $\Omega \subset \R^n$ is a bounded domain, $f \colon \Omega \to \R$ is given, and $u \colon \overline \Omega \to \R$ is the unknown.
The Laplacian $\Delta u$ is given by $\Delta u(x) = \sum_{i = 1}^n u_{x_i x_i}(x)$.

\begin{defn}
  A \emph{classical solution} to \eqref{eq:poissonDirichlet} is a function $u \in \CC^2(\Omega) \cap \CC^0(\overline\Omega)$ satisfying \eqref{eq:poissonDirichlet} pointwise (in the usual sense).
  In particular, this requires $f \in \CC^0(\Omega)$.
\end{defn}

  The Poisson equation appears in different contexts in natural and engineering sciences.
  For instance, $u$ is the displacement of a membrane localized in $\Omega \subset \R^2$, where $f$ describes a force and $u = 0$ on $\partial\Omega$ that the membrane is fixed on $\partial\Omega$.
  $u$ can also describe the temperature distribution in a solid $\Omega$ (stationary in time), where $f$ is a source of energy and the temperature on the boundary $\partial\Omega$ is given.
  If $u$ is the concentration of a chemical substance, $f$ describes the production of the chemical and there is no chemical on $\partial\Omega$.
  In the latter two cases $\Delta u$ describes the diffusion or heat conduction with the flux $-\nabla u$.

  Often we do not have classical solutions to \eqref{eq:poissonDirichlet} or we cannot show easily the existence of a classical solution.
  Therefore, different concepts of generalized solutions are used and we will focus here on weak solutions.

\section{The Concept of Weak Solutions}
\label{sec:weakSolutions}

Let $u$ be a classical solution to \eqref{eq:poissonDirichlet}.
Then integrating by parts, we obtain
\begin{equation}
  \label{eq:weakPoissonDirichlet}
  \int_\Omega \nabla u(x) \cdot \nabla \varphi(x) \d x = \int_\Omega f(x) \varphi(x) \d x \quad\text{for all } \varphi \in \CC_0^\infty(\Omega).
\end{equation}
For this identity we only need $u \in \CC^1(\Omega)$ or even $u \in \HH^1(\Omega)$ is sufficient.
Recall that $\HH^k(\Omega) = \WW^{k,2}(\Omega)$ and $\HH_0^k(\Omega) = \WW_0^{k,2}(\Omega)$.
In particular, if $u \in \HH_0^1(\Omega)$ and $\partial\Omega \in \CC^1$, $u$ satisfies $\Tr(u) = 0$ by Theorem \ref{thm:trace} so that the boundary condition $u = 0$ holds in a weak sense.

Another concept of generalized solutions for \eqref{eq:poissonDirichlet} is the so called strong solution which has the weak derivatives of second order so that $-\Delta u(x) = f(x)$ a.e. in $\Omega$.

\begin{defn}
  \begin{enumerate}[a)]
    \item A \emph{weak solution} to \eqref{eq:poissonDirichlet} is  a function in $\HH_0^1(\Omega)$ satisfying 
      \begin{equation}
        \label{eq:weakSolution}
        \int_\Omega \nabla u \cdot \nabla v \d x = \int_\Omega f v \d x \quad\text{for all } v \in \HH_0^1(\Omega).
      \end{equation}
    \item A \emph{strong solution} to \eqref{eq:poissonDirichlet} is a function $u \in \HH_{\loc}^2(\Omega) \cap \HH_0^1(\Omega)$ satisfying $-\Delta u = f$ a.e. in $\Omega$.
  \end{enumerate}
\end{defn}

Note that \eqref{eq:weakPoissonDirichlet} and \eqref{eq:weakSolution} are equivalent as $\CC_0^\infty(\Omega)$ is dense in $\HH_0^1(\Omega)$.
If $u$ is a classical solution to \eqref{eq:poissonDirichlet} with $u \in \HH^1(\Omega)$ it satisfies $u \in \HH_0^1(\Omega)$ by Theorem \ref{thm:trace}, as $\Tr(u) = u|_{\partial\Omega} = 0$. 
Hence, $u$ is a weak solution to \eqref{eq:poissonDirichlet} as it satisfies \eqref{eq:weakSolution}.
$u$ is also a strong solution.

If $u \in \HH_0^1(\Omega)$ is a weak solution to \eqref{eq:poissonDirichlet} satisfying $u \in \HH_{\loc}^2(\Omega)$, then by \eqref{eq:weakSolution} and the definition of weak derivatives we have
\begin{align*}
\int_\Omega f \varphi \d x
&= \int_\Omega \nabla u \cdot \nabla \varphi \d x
= \sum_{i = 1}^n \int_\Omega u_{x_i} \varphi_{x_i} \d x \\
&= -\sum_{i = 1}^n \int_\Omega u_{x_i x_i} \varphi\d x 
= \int_\Omega (-\Delta u) \varphi \d x \quad \text{for all } \varphi \in \CC_0^\infty(\Omega).
\end{align*}

Hence, by Lemma \ref{lem:fundamental}, $-\Delta u = f$ a.e. in $\Omega$ and $u$ is a strong solution. If $u$ satisfies in addition $u \in \CC^2(\Omega) \cap \CC^0(\overline\Omega)$ and $f \in \CC^0(\Omega)$, then $-\Delta u = f$ a.e. in $\Omega$ holds in the classical sense. 
By continuity and since $u \in \HH_0^1(\Omega) \cap \CC^0(\overline\Omega)$ implies $0 = \Tr(u) = u|_{\partial\Omega}$, we deduce that $u$ is a classical solution to \eqref{eq:poissonDirichlet}.

We will therefore first show the existence of a unique weak solution to \eqref{eq:poissonDirichlet} and then try to show that $u$ has more regularity to deduce that it is a strong or even classical solution.

For a general boundary condition $u = g$ on $\partial\Omega$ for the Poisson equation $-\Delta u = f$ in $\Omega$, one requires that $g \in \Ell^2(\partial\Omega)$ is such that $g = \Tr(w)$ for some $w \in \HH^1(\Omega)$.
Then $u \in \HH^1(\Omega)$ is called a weak solution of this problem, if $\tilde u \coloneqq u - w \in \HH_0^1(\Omega)$ and 
$$
\int_\Omega \nabla \tilde u \cdot \nabla v \d x
= \int_\Omega (f v - \nabla w \cdot \nabla w) \d x \quad\text{for all } v \in \HH_0^1(\Omega).
$$

\section{Existence and Uniqueness of Weak Solutions}

In order to prove the existence of weak solutions to \eqref{eq:poissonDirichlet}, we need to introduce the concept of a bounded linear operator on the dual space.
For more details we refer to the functional analysis course or e.g. \cite[Sections 2.3, 2.4]{dobrowolski2010angewandte}.

\begin{defn}
  Let $X$ and $Y$ be real Banach spaces and $H$ be a real Hilbert space.
  \begin{enumerate}[a)]
    \item A mapping $A \colon X \to Y$ is called \emph{bounded linear operator} if $A(\lambda u + \mu v) = \lambda A(u) + \mu A(v)$ for all $u,v \in X$, $\lambda, \mu \in \R$ and there is $C> 0$ such that $\|A(u)\|_Y \leq C \, \|u\|_X$ for all $u \in X$.
      Then, $\|A\| \coloneqq \sup\{\|A(u)\|_Y \colon \|u\|_X \leq 1 \} < \infty$.
    \item A bounded linear operator $u^* \colon X \to \R$ is called \emph{bounded linear functional} with $\|u^*\|_{X^*} \coloneqq \sup\{u^*(u) \colon \|u\|_X \leq 1\}$.
      Then
      $$
      X^* \coloneqq \{ u^* \colon X \to \R \colon u^* \text{ linear, } \|u^*\|_{X^*} < \infty\}
      $$
      is the \emph{dual space of} $X$.
      $X^*$ is a Banach space with norm $\|\,\cdot\,\|_{X^*}$ and we denote by $\langle u^*, u\rangle_X \coloneqq u^*(u) \in \R$ for all $u \in X, u^* \in X^*$ the \emph{pairing of $X^*$ and $X$}.
    \item If $H$ is a Hilbert space, then $H^*$ is a Hilbert space.
      For $k \in \N$ and $\Omega \subset \R^n open$, we denote the dual space of $\HH_0^k(\Omega)$ by $\HH^{-k}(\Omega) \coloneqq (\HH_0^k(\Omega))^*$.
  \end{enumerate}
\end{defn}

The elements of $H^*$ have a very specific form.

\begin{thm}[Riesz representation theorem]
  \label{thm:RieszFrechet}
  Let $H$ be a Hilbert space with scalar product $(\,\cdot\, , \,\cdot\,)$.
  Then for each $u^* \in H^*$ there exists a unique $u \in H$ such that
  $$
  \langle u^*, v \rangle_H = (u, v) \quad\text{for all } v \in H.
  $$
  The mapping $u^* \to u$ is a linear isomorphism of $H^*$ onto $H$.
\end{thm}

\begin{proof}
  See \cite[Satz 2.25]{dobrowolski2010angewandte}.
\end{proof}

The theorem of Lax-Milgram provides the basis for the existence of weak solutions.
In the context of \eqref{eq:weakSolution}, please note that $B[u,v] \coloneqq \int_\Omega \nabla u \cdot \nabla v \d x$ is bilinear.

\begin{thm}[Lax-Milgram]
  \label{thm:Lax-Milgram}
  Let $H$ be a Hilbert space with inner product $(\,\cdot\, , \,\cdot\,)$.
  Assume that $B \colon H \times H \to \R$ is a bilinear mapping such that there exist $\alpha, \beta > 0$ with 
  \begin{alignat}{2}
    \label{eq:contBil}
    |B[u,v]| &\leq \alpha \|u\|_H \|v\|_H &&\quad\text{for all } u, v \in H \text{ and}\\
    \label{eq:coercive}
    \beta \|u\|_H^2 &\leq B[u,u] &&\quad\text{for all } u \in H.
    \intertext{Moreover, let $F^* \in H^*$.
    Then there exists a unique $u \in H$ such that}
    \label{eq:functionalSolution}
    B[u,v] &= \langle F^*, v \rangle_H &&\quad\text{for all } v \in H.
  \end{alignat}
\end{thm}

\begin{proof}
  We will only prove the case of $B$ being symmetric.
  For the general case, we refer to \cite[Theorem 1 in Section 6.2.1]{evans2010partial}.
  Assume that $B[u,v] = B[v,u]$ for all $u,v \in H$.
  Then we claim that
  $$
  (\!(\!( u, v )\!)\!) \coloneqq B[u,v] \quad\text{for all } u,v \in H
  $$
  defines a scalar product on H.
  Indeed, $(\!(\!(\,\cdot\, , \,\cdot\, )\!)\!)$ is bilinear and symmetric and, by \eqref{eq:coercive}, $(\!(\!(u,u )\!)\!) \geq 0$ holds for all $u \in H$ and $(\!(\!( u,u )\!)\!) = 0$ if and only if $u = 0$.
  If we define the associated norm via $\vertiii u \coloneqq \Big( B[u,u] \Big)^{\frac{1}{2}}$, \eqref{eq:contBil} and \eqref{eq:coercive} imply
  $$
  \sqrt{\beta} \, \|u\|_H \leq \vertiii u \leq \sqrt{\alpha} \, \|u\|_H \quad\text{for all } u \in H.
  $$
  Hence, $\vertiii{ \,\cdot\,}$ and $\|\,\cdot\,\|_H$ are equivalent norms on $H$ so that it is equivalent to use either $(\!(\!( \,\cdot\, , \,\cdot\, )\!)\!)$ or $(\,\cdot\, , \,\cdot\,)$ on $H$ as a scalar product. In particular, $H$ becomes again a Hilbert space with respect to the new scalar product $(\!(\!( \,\cdot\, , \,\cdot\, )\!)\!)$.

  Then applying Theorem \ref{thm:RieszFrechet} (with $(\!(\!( \,\cdot\, , \,\cdot\, )\!)\!)$), we obtain $u \in H$ such that
  $$
  \langle F^* , v \rangle_H = (\!(\!( u , v )\!)\!).
  $$
  Hence, $u$ satisfies \eqref{eq:functionalSolution}.

  $u$ is unique, because if $u_1, u_2 \in H$ satisfy \eqref{eq:functionalSolution}, then
  $$
  B[u_1 - u_2, v] = B[u_1, v] - B[u_2, v] = 0 \quad\text{for all } v \in H.
  $$
  But then by \eqref{eq:coercive} we have
  $$
  \beta \, \|u_1 - u_2\|_H^2 \leq B[u_1 - u_2, u_1 - u_2] = 0
  $$
  so that $u_1 = u_2$.
\end{proof}

Now we can prove the existence of a unique weak solution to \eqref{eq:poissonDirichlet}.

\begin{thm}
  Let $\Omega$ be a bounded domain and $f \in \Ell^2(\Omega)$.
  Then there exists a unique weak solution $u \in \HH_0^1(\Omega)$ to \eqref{eq:poissonDirichlet}.
\end{thm}

\begin{proof}
  We apply the Lax-Milgram Theorem \ref{thm:Lax-Milgram} to $H \coloneqq \HH_0^1(\Omega)$, $B[u,v] \coloneqq \int_\Omega \nabla u \cdot \nabla v \d x$ for $u,v \in \HH_0^1(\Omega)$ and $F^* \colon \HH_0^1(\Omega) \to \R$, $\langle F^*, v \rangle_{\HH_0^1(\Omega)} \coloneqq \int_\Omega f v \d x$.
  \begin{enumerate}[i)]
    \item Obviously, $B$ is bilinear and symmetric with $B \colon H \times H \to \R$.
      Moreover, by Hölder's inequality and the Poincar\'e inequality \eqref{eq:poincare} (with constant $C_p > 0$) we have
      \begin{alignat*}{2}
        |B[u,v]| 
        &\leq \|\nabla u\|_{\Ell^2(\Omega)} \|\nabla v\|_{\Ell^2(\Omega)}
        \leq \|u\|_{\HH^1(\Omega)} \|v\|_{\HH^1(\Omega)} &&\quad\text{for all } u, v \in \HH_0^1(\Omega) \text{ and } \\
        \|u\|_{\HH^1(\Omega)}^2 &= \|u\|_{\Ell^2(\Omega)}^2 + \|\nabla u\|_{\Ell^2(\Omega)}^2 &&\\
        &\leq (C_p^2 + 1) \|\nabla u\|_{\Ell^2(\Omega)}^2  
        = (C_p^2 + 1) B[u,u] &&\quad\text{for all } u \in \HH_0^1(\Omega)
      \end{alignat*}
      so that \eqref{eq:contBil} and \eqref{eq:coercive} hold with $\alpha = 1$ and $\beta = \frac{1}{C_p^2 + 1}$.

    \item Obviously, $\langle F^*, v \rangle_{\HH_0^1(\Omega)} = \int_\Omega f v \d x$ is linear in $v$ and by Hölder
      $$
      |\langle F^*, v \rangle_{\HH_0^1(\Omega)}|
      \leq \|f\|_{\Ell^2(\Omega)} \|v\|_{\Ell^2(\Omega)}
      \leq \|f\|_{\Ell^2(\Omega)} \|v\|_{\HH^1(\Omega)} \quad\text{for all } v \in \HH_0^1(\Omega).
      $$
      Hence, $F^* \in H^*$ with $\|F^*\|_{H^*} \leq \| f \|_{\Ell^2(\Omega)}$.
    \end{enumerate}
  In view of i) and ii) the claim follows from the Lax-Milgram theorem.
\end{proof}

\section{Regularity of Weak Solutions}

Our aim is to show that the weak solution $u$ to \eqref{eq:poissonDirichlet} has better regularity that just being in $\HH_0^1(\Omega)$.
To motivate the following result, assume that $u \in \CC_0^\infty(\Omega)$ satisfies \eqref{eq:poissonDirichlet}.
Then integration by parts yields
\begin{align*}
  \|f\|_{\Ell^2(\Omega)}^2
  &= \int_\Omega f^2 \d x
  = \int_\Omega \Delta u\, \Delta u \d x 
  = \sum_{i,j = 1}^n \int_\Omega u_{x_i x_i} u_{x_j x_j} \d x \\
  &= - \sum_{i,j = 1}^n \int_\Omega u_{x_i x_i x_j} u_{x_j} \d x 
  = \sum_{i,j = 1}^n \int_\Omega u_{x_i x_j} u_{x_i x_j} \d x
  = \sum_{|\alpha| = 2} \| \DD^\alpha u \|_{\Ell^2(\Omega)}^2.
\end{align*}
So $\|\DD^\alpha u\|_{\Ell^2(\Omega)} \leq \|f\|_{\Ell^2(\Omega)}$ for all $|\alpha| = 2$.
Similarly, as $-\Delta(u_{x_i}) = f_{x_i}$, the $\Ell^2$-norm of the $(m+2)$-nd derivatives of $u$ can be estimated by the $\Ell^2$-norm of the $m$-th derivatives of $f$.
Hence, informally ``$u$ has two more derivatives in $\Ell^2$ than $f$''.
However, there is no solution $u \in \CC_0^\infty(\Omega)$ to \eqref{eq:poissonDirichlet} apart from $u \equiv 0$.
But results of this kind can be proved, which are of course more difficult to prove.

\begin{thm}
  \label{thm:regularity}
  Let $\Omega \subset \R^n$ be a bounded domain, $f \in \Ell^2(\Omega)$ and $u \in \HH_0^1(\Omega)$ be the unique weak solution to \eqref{eq:poissonDirichlet}, and $V \Subset \Omega$ be open, $m \in \N$.
  \begin{enumerate}[a)]
    \item $u \in \HH_{\loc}^2(\Omega)$ and $\|u\|_{\HH^2(V)} \leq C_1 \, \|f\|_{\Ell^2(\Omega)}$. If $\partial\Omega \in \CC^2$, then $u \in \HH^2(\Omega)$ and
      \begin{align*}
      \|u\|_{\HH^2(\Omega)} &\leq C_2 \, \|f\|_{\Ell^2(\Omega)}.
    \intertext{\item If $f \in \HH^m(\Omega)$, then $u \in \HH_{\loc}^{m + 2}(\Omega)$ and }
        \|u\|_{\HH^{m + 2}(V)} &\leq C_3 \, \|f\|_{\HH^m(\Omega)}.
        \intertext{If $\partial\Omega \in \CC^{m+2}$, then $u \in \HH^{m + 2}(\Omega)$ and}
        \|u\|_{\HH^{m + 2}(\Omega)} &\leq C_4 \, \|f\|_{\HH^m(\Omega)}.
      \end{align*}
      \item If $f \in \CC^\infty(\Omega)$, then $u \in \CC^\infty(\Omega)$. If in addition $f \in \CC^\infty(\overline\Omega)$ and $\partial\Omega \in \CC^\infty$, then $u \in \CC^\infty(\overline\Omega)$.
  \end{enumerate}
  The constants $C_1, C_3$ depend on $\Omega$, $V$ (and $m$), whereas the constants $C_2, C_4$ depend on $\Omega$ (and $m$).
\end{thm}

\begin{proof}
  We refer to \cite[Theorems 1-6 in Section 6.3 and Theorem 6 in Section 6.2]{evans2010partial}.
\end{proof}

In particular, as $u \in \HH_{\loc}^2(\Omega)$, $u$ is always a strong solution (see Section \ref{sec:weakSolutions}).
As Theorem \ref{thm:generalEmbedding} implies that $\HH^k(\Omega)$ is continuously embedded into $\CC^2(\overline\Omega)$ if $k > \frac{n}{2} + 2$, $u$ is a classical solution if $f \in \HH^m(\Omega)$ and $\partial\Omega \in \CC^{m + 2}$ for some $m \in \N$ with $m > \frac{n}{2}$.

One important ingredient of the proofs of these regularity results is the approximation of weak derivatives by difference quotients.
The latter is also of interest in the theory of Sobolev spaces.

\begin{defn}
  Let $\Omega \subset \R^n$ be open, $V \Subset \Omega$, and $u \in \Ell^1_{\loc}(\Omega)$.
  The \emph{$i$-th difference quotient of size $h$} is
  $$
  \DD_i^h u(x) \coloneqq \frac{u(x + he_i) - u(x)}{h} \quad\text{for } i \in \{1, \dots,n\}, x \in V, h \in \R \text{ with } 0 < |h| < \dist(V, \partial \Omega).
  $$
  We define
  $$
  \DD^h u\coloneqq ( \DD_1^h u, \dots,D_n^h u).
  $$
\end{defn}

In order to prove the connection between difference quotients and weak derivatives we need further results from functional analysis (see e.g. \cite{dobrowolski2010angewandte} or \cite{alt2012lineare}):

\begin{prop}
  \label{prop:banachAlaoglu}
  Let $X$ be a Banach space.
  \begin{enumerate}[a)]
    \item $X$ is \emph{reflexive} if $(X^*)^* = X$ in the sense that for all $u^{**} \in (X^*)^*$ there exists a unique $u \in X$ with
      $$
      \langle u^{**}, u^* \rangle_{X^*} = \langle u^*, u \rangle_X \quad\text{for all } u^* \in X^*.
      $$
    \item $(u_n)_{n \in \N} \subset X$ \emph{converges weakly} to $u \in X$ if 
      $$
      \langle u^*, u_k \rangle_X \to \langle u^*, u \rangle_X \quad\text{as } k\to \infty \text{ for all } u^* \in X^*, \text{ written } u_k \rightharpoonup u \text{ in } X.
      $$
    \item If $X$ is reflexive, then any bounded sequence $(u_k)_{k \in \N} \subset X$ has a weakly convergent subsequence.

      In particular, a Hilbert space $H$ and the Lebesgue spaces $\Ell^p(\Omega), p \in (1,\infty)$, are reflexive and $u_k \rightharpoonup u$ in $\Ell^p(\Omega)$ if and only if $\int_\Omega u_k g \d x \to \int_\Omega u g \d x$ for all $g \in \Ell^q(\Omega)$ with $\frac{1}{p} + \frac{1}{q} = 1$.
  \end{enumerate}
\end{prop}

Then we have the following result on difference quotients.

\begin{thm}
  Let $\Omega \subset \R^n$ be open and $u \in \Ell_{\loc}^1(\Omega)$.
  \begin{enumerate}[a)]
    \item If $p \in [1,\infty)$ and $u \in \WW^{1,p}(\Omega)$, then there exists $C_1 > 0$ depending on $p$ and $n$ such that for all $V \Subset \Omega$ and all $0 < |h| < \frac{1}{2} \dist(V, \partial\Omega)$ we have
      \begin{align}
        \label{eq:boundedQuotientIfWeaklyDifferentiable}
        \|\DD^h u\|_{\Ell^p(V)} &\leq C_1 \, \|\nabla u\|_{\Ell^p(\Omega)}
      \intertext{\item Assume that $p \in (1,\infty)$, $u \in \Ell^p(V)$ and there exists $C_2 > 0$ such that}
        \label{eq:weaklyDifferentiableIfBoundedQuotient}
        \|D^h u\|_{\Ell^p(V)} &\leq C_2  \quad\text{for all } 0 < |h| < \frac{1}{2} \dist(V, \partial\Omega).
      \end{align}
      Then $u \in \WW^{1,p}(V)$ and $\|\nabla u\|_{\Ell^p(V)} \leq C_2$.
  \end{enumerate}
\end{thm}

\begin{proof}
  \begin{enumerate}[a)]
    \item First assume that $u \in \CC^1(\Omega) \cap \WW^{1,p}(\Omega)$, $x \in V$, $i \in \{1,\dots,n\}$.
      Then by the mean value theorem,
      $$
      |u(x + he_i) - u(x)| \leq |h| \int_0^1 |\nabla u(x + th e_i)| \d t.
      $$
      Hence, by Hölder's inequality we have with $\frac{1}{p} + \frac{1}{q} = 1$
      \begin{align*}
        \int_V |\DD^h u|^p \d x
        &\leq C_3 \sum_{i = 1}^n \int_V \bigg[ |(0,1)|^{\frac{1}{q}} \cdot \Big( \int_0^1 |\nabla u(x + the_i)| \d t \Big)^{\frac{1}{p}} \bigg]^p \d x \\
        &= C_3 \sum_{i = 1}^n \int_0^1 \int_V |\nabla u(x + the_i)|^p \d x \d t \\
        &\leq C_3\, n\, \|\nabla u\|^p_{\Ell^p(\Omega)}.
      \end{align*}
      As this estimate holds for all $u \in \CC^1(\Omega) \cap \WW^{1,p}(\Omega)$ and this space is dense in $\WW^{1,p}(\Omega)$ by Theorem \ref{thm:meyersSerrin}, we conclude by Fatou's lemma that \eqref{eq:boundedQuotientIfWeaklyDifferentiable} with $C_1 = C_3 n$.

    \item Assume that \eqref{eq:weaklyDifferentiableIfBoundedQuotient} holds.
      Let $i \in \{1,\dots,n\}, \varphi \in \CC_0^\infty(V)$ and 
      $$
      0 < |h| < \frac{1}{2} \min\{ \dist(V,\partial\Omega), \dist(\supp \varphi, \partial V)\}.$$
      Then, as the choice of $h$ gives $\supp \varphi \subset V \cap \tilde V$ with $\tilde V \coloneqq \{ x + he_i \colon x \in V \}$, the transformation rule implies
      \begin{align*}
        \int_V u(\DD_i^h \varphi)\d x
        &= \int_V u(x) \frac{\varphi(x + he_i) - \varphi(x)}{h} \d x \\
        &= \int_{\tilde V} \frac{u(y - h e_i)\varphi(y)}{h} \d y - \int_V \frac{u(x) \varphi(x)}{h} \d x \\
        &= \int_V - \frac{u(x - he_i) - u(x)}{-h} \varphi(x) \d x \\
        &= - \int_V (\DD_i^{-h} u) \varphi \d x.
      \end{align*}
      As \eqref{eq:weaklyDifferentiableIfBoundedQuotient} implies
      $$
      \sup_{0 < h < \frac{1}{2} \dist(V, \partial\Omega)} \|\DD_i^{-h} u\|_{\Ell^p(V)} < \infty
      $$
      and $p \in (1,\infty)$, Proposition \ref{prop:banachAlaoglu} c) implies that there are $h_k \to 0$ and $v_i \in \Ell^p(V)$ such that $\DD_i^{-h_k} u \rightharpoonup v_i$ as $k \to \infty$ weakly in $\Ell^p(V)$, i.e.
      \begin{equation}
        \label{eq:weakConvergenceInLp}
        \int_V (\DD_i^{-h_k} u) g \d x \to \int_V v_i g \d x \quad\text{for all } g \in \Ell^q(V).
      \end{equation}
      As $V$ is bounded, we conclude
      $$
        \int_V u \varphi_{x_i} \d x
        = \lim_{h \to \infty} \int_V u( \DD_i^{h_k} \varphi ) \d x
        = \lim_{k \to \infty} - \int_V ( \DD_i^{-h_k} u) \varphi \d x
        = - \int_V v_i \varphi \d x.
      $$
      Hence, as $\varphi \in \CC_0^\infty(V)$ is arbitrary, we have $u_{x_i} = v_i \in \Ell^p(V)$ in the weak sense.
      As $u \in \Ell^p(V)$, we conclude that $u \in \WW^{1,p}(V)$ and
      \[
      \|u_{x_i}\|_{\Ell^p(V)} \leq \liminf_{k \to \infty} \|\DD_i^{-h_k} u \|_{\Ell^p(V)} < \infty. \qedhere
    \]
  \end{enumerate}
\end{proof}

Finally, we compare weak and classical partial derivatives.

\begin{defn}
  $u \colon \Omega \to \R$ is \emph{differentable at $x \in \Omega$} if there is $a \in \R^n$ such that 
  $$
  u(y) = u(x) + a \cdot (y - x) + o(|y - x|) \quad\text{where } \lim_{y \to x} \frac{o(|y - x|)}{|y - x|} = 0.
  $$
  In this case, $\nabla u(x) \coloneqq a$ is called the \emph{gradient of $u$}.
\end{defn}

Then we have the following result.

\begin{prop}
Let $\Omega \subset \R^n$ be open, $p \in (n,\infty]$ and $u \in \WW_{\loc}^{1,p}(\Omega)$.
Then $u$ is differentiable a.e. in $\Omega$ and its gradient equals its weak gradient a.e. in $\Omega$.
\end{prop}

\begin{proof}
  \begin{enumerate}[i)]
    \item Let $p \in (n,\infty)$, $x,y \in \Omega$ with $|y - x| = r > 0$, and $u \in \CC^1(\overline{\BB_{2r}(x)})$.
      Since we have $\BB_r(x), \BB_r(y) \subset \BB_{2r}(x)$, part iv) of the proof of Theorem \ref{thm:morrey} implies that there is $C_1 > 0$ depending only on $n$ and $p$ such that
      \begin{equation}
        \label{eq:differenceEstByGrad}
        |u(y) - u(x)|
        \leq C_1 r^{1 - \frac{n}{p}} \Big( \int_{\BB_{2r}(x)} |\nabla u(z) |^p \d z \Big)^{\frac{1}{p}} \quad\text{for all } u \in \CC^1(\overline{\BB_{2r}(x)}).
      \end{equation}
      Again by approximation, \eqref{eq:differenceEstByGrad} holds for all $u \in \WW^{1,p}(\BB_{2r}(x))$.

    \item Let $u \in \WW_{\loc}^{1,p}(\Omega)$ and $\nabla u$ the weak gradient of $u$.
      Then by Lebesgue's differentiation theorem (see \cite[Section E.4]{evans2010partial})
      $$
      \frac{1}{|\BB_r(x)|} \int_{\BB_r(x)} |\nabla u(x) - \nabla u(z)|^p \d z \to 0 \quad \text{as } r \downarrow 0 \text{ for a.e. } x \in \Omega.
      $$
      We fix any such $x$ and apply \eqref{eq:differenceEstByGrad} to 
      $v(y) \coloneqq u(y) - u(x) - \nabla u(x) \cdot(y - x)$ with $r = |y - x|$.
      Then
      \begin{align*}
        |u(y) - u(x) - \nabla u(x) \cdot (y - x)|
        &\leq C_1 \, r^{1 - \frac{n}{p}} \Big(\int_{\BB_{2r}(x)} |\nabla u(z) - \nabla u(x)|^p \d z \Big)^{\frac{1}{p}} \\
        &\leq C_2 \, r\, \bigg( \frac{1}{|\BB_{2r}(x)|} \int_{\BB_{2r}(x)} |\nabla u(x) - \nabla u(z)|^p \d z \bigg)^{\frac{1}{p}} \\
        &= o(r) = o(|y - x|).
      \end{align*}
      Hence, $u$ is differentiable at $x$ and its gradient equals the weak gradient.

    \item As $\WW_{\loc}^{1,\infty} \subset \WW_{\loc}^{1,p}(\Omega)$ for all $p \in [1,\infty)$, the case $p = \infty$ follows from i), ii). \qedhere
  \end{enumerate}
\end{proof}

